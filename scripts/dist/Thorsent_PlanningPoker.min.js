!function(a,b){"use-strict";var c=new Firebase("https://sweltering-torch-73.firebaseio.com/"),d=Thorsent.PlanningPoker.Decks;b.module("thorsent",["ngRoute","ngMaterial","firebase"]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("blue")}]).config(["$routeProvider",function(a){a.when("/",{controller:"LandingCtrl",templateUrl:"views/landing.html"}).when("/:roomId/",{controller:"RoomCtrl",templateUrl:"views/room.html"}).otherwise({redirectTo:"/"})}]).factory("RoomHelper",["$q","$firebase",function(a,b){return{checkIfRoomExists:function(b){var d=a.defer();return c.child("rooms").child(b).once("value",function(a){exists=null!==a.val(),d.resolve(exists)}),d.promise},generateRoomId:function(){return Math.floor(999e5*Math.random()+1e5).toString()},generateUserId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},getRoom:function(a){var d=c.child("rooms").child(a);return b(d).$asObject()},getUser:function(a,d){var e=c.child("rooms").child(a).child("users").child(d);return b(e).$asObject()},newRoom:function(a,d){b(c.child("rooms").child(a)).$set({deckIndex:d,reveal:!1,updatedAt:Firebase.ServerValue.TIMESTAMP})},newUser:function(a,d,e){b(c.child("rooms").child(a).child("users").child(d)).$set({leader:e,vote:null,voter:!0})}}}]).controller("LandingCtrl",["$rootScope","$scope","$location","$firebase","RoomHelper",function(a,b,c,d,e){b.joinRoom=function(){c.path("/"+b.roomId)},b.newRoom=function(){var b=e.generateRoomId(),d=0;e.newRoom(b,d);var f=e.generateUserId(),g=!0;e.newUser(b,f,g),a.uuid=f,c.path("/"+b)}}]).controller("RoomCtrl",["$rootScope","$scope","$routeParams","$location","RoomHelper",function(b,e,f,g,h){function i(){for(var a in e.room.users)e.room.users[a].vote=null;e.room.reveal=!1}function j(){e.user.leader?c.child("rooms").child(e.room.$id).remove():c.child("rooms").child(e.room.$id).child("users").child(e.user.$id).remove(),b.uuid=null}e.changeDeck=function(){i(),e.room.updatedAt=Firebase.ServerValue.TIMESTAMP,e.room.$save()},e.chooseCard=function(a,b,c){e.user.voter&&(e.user.vote={val:a,text:b,fa:c||""},e.user.$save())},e.reset=function(){i(),e.room.updatedAt=Firebase.ServerValue.TIMESTAMP,e.room.$save()},e.reveal=function(){e.room.reveal=!0,e.room.updatedAt=Firebase.ServerValue.TIMESTAMP,e.room.$save()},e.toggleVoter=function(){e.user.$save()},e.$watch("room.deckIndex",function(){e.selectedDeck=d[e.room.deckIndex].cards});var k=f.roomId,l=b.uuid;h.checkIfRoomExists(k).then(function(a){if(a){if(e.room=h.getRoom(k),!l){l=h.generateUserId();var b=!1;h.newUser(k,l,b)}e.user=h.getUser(k,l),e.cardDecks=d,e.selectedDeckIndex=0,e.selectedDeck=d[e.selectedDeckIndex].cards}else g.path("/")}),e.$on("$locationChangeStart",function(){j()}),a.onbeforeunload=function(){j()},e.$on("$destroy",function(){delete a.onbeforeunload})}])}(window,window.angular);